<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; Celeritas v0.3.0-dev-24+65ba1f71 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview" href="overview.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Celeritas
            <img src="_static/celeritas-thumbnail.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.3.1-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#toolchain-installation">Toolchain installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-celeritas">Building Celeritas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cmake-presets">CMake Presets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#downstream-usage-as-a-library">Downstream usage as a library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">Acknowledgments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="appendices/release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices/development.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices/administration.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices/license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Celeritas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<span id="infrastructure"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h1>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p>Celeritas is built using modern <a class="reference external" href="https://cmake.org">CMake</a>. It has multiple dependencies to operate
as a full-featured code, but each dependency can be individually disabled as
needed.</p>
<p>The code requires external dependencies to build with full functionality.
However, any combination of these requirements can be omitted to enable
limited development on experimental HPC systems or personal machines with
fewer available components.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Category</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://developer.nvidia.com/cuda-toolkit">CUDA</a></p></td>
<td><p>Runtime</p></td>
<td><p>GPU computation</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://geant4.web.cern.ch/support/download">Geant4</a></p></td>
<td><p>Runtime</p></td>
<td><p>Preprocessing physics data for a problem input</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://geant4.web.cern.ch/support/download">G4EMLOW</a></p></td>
<td><p>Runtime</p></td>
<td><p>EM physics model data</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="http://hepmc.web.cern.ch/hepmc/">HepMC3</a></p></td>
<td><p>Runtime</p></td>
<td><p>Event input</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://docs.amd.com">HIP</a></p></td>
<td><p>Runtime</p></td>
<td><p>GPU computation</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/nlohmann/json">nljson</a></p></td>
<td><p>Runtime</p></td>
<td><p>Simple text-based I/O for diagnostics and program setup</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.open-mpi.org">Open MPI</a></p></td>
<td><p>Runtime</p></td>
<td><p>Shared-memory parallelism</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://root.cern">ROOT</a></p></td>
<td><p>Runtime</p></td>
<td><p>Input and output</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="http://swig.org">SWIG</a></p></td>
<td><p>Runtime</p></td>
<td><p>Low-level Python wrappers</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://gitlab.cern.ch/VecGeom/VecGeom">VecGeom</a></p></td>
<td><p>Runtime</p></td>
<td><p>On-device navigation of GDML-defined detector geometry</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://github.com/michaeljones/breathe#readme">Breathe</a></p></td>
<td><p>Docs</p></td>
<td><p>Generating code documentation inside user docs</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://www.doxygen.nl">Doxygen</a></p></td>
<td><p>Docs</p></td>
<td><p>Code documentation</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.sphinx-doc.org/">Sphinx</a></p></td>
<td><p>Docs</p></td>
<td><p>User documentation</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://pypi.org/project/sphinxcontrib-bibtex/">sphinxbib</a></p></td>
<td><p>Docs</p></td>
<td><p>Reference generation for user documentation</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://clang.llvm.org/docs/ClangFormat.html">clang-format</a></p></td>
<td><p>Development</p></td>
<td><p>Code formatting enforcement</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://cmake.org">CMake</a></p></td>
<td><p>Development</p></td>
<td><p>Build system</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://git-scm.com">Git</a></p></td>
<td><p>Development</p></td>
<td><p>Repository management</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/google/googletest">GoogleTest</a></p></td>
<td><p>Development</p></td>
<td><p>Test harness</p></td>
</tr>
</tbody>
</table>
<p>Ideally you will build Celeritas with all dependencies to gain the full
functionality of the code, but there are circumstances in which you may not
have (or want) all the dependencies or features available. By default, the CMake code in
Celeritas queries available packages and sets several
<code class="docutils literal notranslate"><span class="pre">CELERITAS_USE_{package}</span></code>
options based on what it finds, so you have a good chance of successfully
configuring Celeritas on the first go. Some optional features
will error out in the configure if their required
dependencies are missing, but they will update the CMake cache variable so that
the next configure will succeed (with that component disabled).</p>
</section>
<section id="toolchain-installation">
<h2>Toolchain installation<a class="headerlink" href="#toolchain-installation" title="Permalink to this heading"></a></h2>
<p>The recommended way to install dependencies is with <code class="docutils literal notranslate"><span class="pre">Spack</span></code>,
an HPC-oriented package manager that includes numerous scientific packages,
including those used in HEP. Celeritas includes a Spack environment at
<code class="file docutils literal notranslate"><span class="pre">scripts/spack.yaml</span></code> that describes the code’s full suite
of dependencies (including testing and documentation). To install these
dependencies:</p>
<ul class="simple">
<li><p>Clone and load Spack following its <cite>getting started instructions
&lt;spack-start&gt;</cite>.</p></li>
<li><p>If using CUDA: run <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">external</span> <span class="pre">find</span> <span class="pre">cuda</span></code> to inform Spack of the existing
installation, and tell Spack to default to building with CUDA support with
the command <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">config</span> <span class="pre">add</span> <span class="pre">packages:all:variants:&quot;+cuda</span>
<span class="pre">cuda_arch=&lt;ARCH&gt;&quot;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;ARCH&gt;</span></code> is the numeric portion of the <cite>CUDA
architecture flags &lt;cuda-arch&gt;</cite>.</p></li>
<li><p>Create the Celeritas development environment with <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">env</span> <span class="pre">create</span>
<span class="pre">celeritas</span> <span class="pre">scripts/spack.yaml</span></code>.</p></li>
<li><p>Install all the dependencies with <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">-e</span> <span class="pre">celeritas</span> <span class="pre">install</span></code>.</p></li>
</ul>
<p>The current Spack environment for full-featured development is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">spack</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">specs</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">doxygen</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;geant4@11</span><span class="nv"> </span><span class="s">cxxstd=17&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git-lfs</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;googletest@1.10:&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hepmc3</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ninja</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nlohmann-json</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mpi</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">py-breathe</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">py-sphinx</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">py-sphinx-rtd-theme</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">py-sphinxcontrib-bibtex</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root cxxstd=17</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;swig@4.1:&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;vecgeom@1.2:</span><span class="nv"> </span><span class="s">+gdml</span><span class="nv"> </span><span class="s">cxxstd=17&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">view</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">concretizer</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">unify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">packages</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">root</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Note: ~gsl and ~math are removed because dd4hep requires them</span><span class="w"></span>
<span class="w">      </span><span class="nt">variants</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~aqua ~davix ~examples ~opengl ~x ~tbb</span><span class="w"></span>
<span class="w">    </span><span class="nt">all</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">providers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">blas</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">openblas</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">        </span><span class="nt">lapack</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">openblas</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">        </span><span class="nt">mpi</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">openmpi</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">      </span><span class="nt">variants</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cxxstd=17</span><span class="w"></span>
<span class="w">      </span><span class="c1"># NOTE: add `+cuda cuda_arch=70` (or similar) to your site packages.py</span><span class="w"></span>
<span class="w">      </span><span class="c1"># spack config add --scope=site packages:all:variants:&quot;+cuda cuda_arch=70&quot;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="building-celeritas">
<h2>Building Celeritas<a class="headerlink" href="#building-celeritas" title="Permalink to this heading"></a></h2>
<p>Once the Celeritas Spack environment has been installed, set your shell’s environment
variables (<code class="docutils literal notranslate"><span class="pre">PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_PREFIX_PATH</span></code>, …) by activating it. Then, you
can configure, build, and test using the provided helper script:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack env activate celeritas
<span class="gp">$ </span>./scripts/build.sh base
</pre></div>
</div>
<p>or manually with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>spack env activate celeritas
<span class="gp">$ </span>mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
<span class="gp">$ </span>cmake ..
<span class="gp">$ </span>make <span class="o">&amp;&amp;</span> ctest
</pre></div>
</div>
</section>
<section id="cmake-presets">
<h2>CMake Presets<a class="headerlink" href="#cmake-presets" title="Permalink to this heading"></a></h2>
<p>To manage multiple builds with different
configure options (debug or release, VecGeom or ORANGE), you can use the
CMake presets provided by Celeritas via the <code class="docutils literal notranslate"><span class="pre">CMakePresets.json</span></code> file for CMake
3.21 and higher:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cmake --preset<span class="o">=</span>default
</pre></div>
</div>
<p>The three main options are “minimal”, “default”, and “full”, which all set
different expectations for available dependencies.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your CMake version is too old, you may get an unhelpful message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CMake Error: Could not read presets from celeritas: Unrecognized &quot;version&quot;</span>
<span class="go">field</span>
</pre></div>
</div>
<p>which is just a poor way of saying the version in the <code class="docutils literal notranslate"><span class="pre">CMakePresets.json</span></code>
file is newer than that version knows how to handle.</p>
</div>
<p>If you want to add your own set of custom options and flags, create a
<code class="docutils literal notranslate"><span class="pre">CMakeUserPresets.json</span></code> file or, if you wish to contribute on a regular
basis, create a preset at <code class="file docutils literal notranslate"><span class="pre">scripts/cmake-presets/</span><em><span class="pre">HOSTNAME</span></em><span class="pre">.json</span></code> and
call <code class="docutils literal notranslate"><span class="pre">scripts/build.sh</span> <span class="pre">{preset}</span></code> to create the symlink, configure the preset,
build, and test. See <code class="file docutils literal notranslate"><span class="pre">scripts/README.md</span></code> in the code repository for more
details.</p>
</section>
<section id="downstream-usage-as-a-library">
<h2>Downstream usage as a library<a class="headerlink" href="#downstream-usage-as-a-library" title="Permalink to this heading"></a></h2>
<p>The Celeritas library is most easily used when your downstream app is built with
CMake. It should require a single line to initialize:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Celeritas</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">CONFIG</span><span class="p">)</span>
</pre></div>
</div>
<p>and if VecGeom or CUDA are disabled a single line to link:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">mycode</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">Celeritas::celeritas</span><span class="p">)</span>
</pre></div>
</div>
<p>Because of complexities involving CUDA Relocatable Device Code, linking when
using both CUDA and VecGeom requires an additional include and the replacement
of <code class="docutils literal notranslate"><span class="pre">target_link_libraries</span></code> with a customized version:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="s">CeleritasLibrary</span><span class="p">)</span>
<span class="nb">celeritas_target_link_libraries</span><span class="p">(</span><span class="s">mycode</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">Celeritas::celeritas</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="examples/minimal.html#example-minimal"><span class="std std-ref">Minimal Celeritas usage</span></a> example demonstrates how to use Celeritas as a
library with a short standalone CMake project.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="overview.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, UT–Battelle/ORNL and Celeritas team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
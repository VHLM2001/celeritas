<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using Celeritas &mdash; Celeritas 0.3.0-rc.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Library API" href="api.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Celeritas
              <img src="_static/celeritas-square.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.3.0-rc.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using Celeritas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#software-library">Software library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cmake-integration">CMake integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#standalone-simulation-app-celer-sim">Standalone simulation app (celer-sim)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input">Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#integrated-geant4-application-celer-g4">Integrated Geant4 application (celer-g4)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#additional-utilities">Additional utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#celer-export-geant">celer-export-geant</a></li>
<li class="toctree-l3"><a class="reference internal" href="#celer-dump-data">celer-dump-data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logging">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">Acknowledgments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="appendices/release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices/development.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices/administration.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices/license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Celeritas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Using Celeritas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-celeritas">
<span id="usage"></span><h1>Using Celeritas<a class="headerlink" href="#using-celeritas" title="Permalink to this heading"></a></h1>
<p>Celeritas includes a core set of libraries for internal and external use, as
well as several helper applications and front ends.</p>
<section id="software-library">
<h2>Software library<a class="headerlink" href="#software-library" title="Permalink to this heading"></a></h2>
<p>The most stable part of Celeritas is, at the present time, the high-level
program interface to the <a class="reference internal" href="api/accel.html#accel"><span class="std std-ref">Acceleritas</span></a> code library. However, many other
components of the API are stable and documented in the <code class="code docutils literal notranslate"><span class="pre">api</span></code> section.</p>
<section id="cmake-integration">
<h3>CMake integration<a class="headerlink" href="#cmake-integration" title="Permalink to this heading"></a></h3>
<p>The Celeritas library is most easily used when your downstream app is built with
CMake. It should require a single line to initialize:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>find_package(Celeritas REQUIRED CONFIG)
</pre></div>
</div>
<p>and if VecGeom or CUDA are disabled a single line to link:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>target_link_libraries(mycode PUBLIC Celeritas::celeritas)
</pre></div>
</div>
<p>Because of complexities involving CUDA Relocatable Device Code, linking when
using both CUDA and VecGeom requires an additional include and the replacement
of <code class="docutils literal notranslate"><span class="pre">target_link_libraries</span></code> with a customized version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>include(CeleritasLibrary)
celeritas_target_link_libraries(mycode PUBLIC Celeritas::celeritas)
</pre></div>
</div>
<p>The <a class="reference internal" href="examples/minimal.html#example-minimal"><span class="std std-ref">Minimal Celeritas usage</span></a> example demonstrates how to use Celeritas as a
library with a short standalone CMake project.</p>
</section>
</section>
<section id="standalone-simulation-app-celer-sim">
<span id="celer-sim"></span><h2>Standalone simulation app (celer-sim)<a class="headerlink" href="#standalone-simulation-app-celer-sim" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">celer-sim</span></code> application is the primary means of running test problems for
independent validation and performance analysis.</p>
<p>Usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>usage: celer-sim {input}.json
       celer-sim [--help|-h]
       celer-sim --version
       celer-sim --config
       celer-sim --dump-default
</pre></div>
</div>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><em><span class="pre">input</span></em><span class="pre">.json</span></code> is the path to the input file, or <code class="docutils literal notranslate"><span class="pre">-</span></code> to read the
JSON from <code class="docutils literal notranslate"><span class="pre">stdin</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--config</span></code> option prints the contents of the <code class="docutils literal notranslate"><span class="pre">[&quot;system&quot;][&quot;build&quot;]</span></code>
diagnostic output. It includes configuration options and the version number.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--dump-default</span></code> option prints the default options for the execution.
Not all variables will be shown, because some are conditional on others.</p></li>
</ul>
<section id="input">
<h3>Input<a class="headerlink" href="#input" title="Permalink to this heading"></a></h3>
<p>In addition to these input parameters, <a class="reference internal" href="#environment"><span class="std std-ref">Environment variables</span></a> can be specified to
change the program behavior.</p>
</section>
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this heading"></a></h3>
<p>The primary output from <code class="docutils literal notranslate"><span class="pre">celer-sim</span></code> is a JSON object that includes several
levels of diagnostic and result data (see <a class="reference internal" href="api/corecel.html#api-io"><span class="std std-ref">I/O</span></a>). The JSON
output should be the only data sent to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, so it should be suitable for
piping directly into other executables such as Python or <code class="docutils literal notranslate"><span class="pre">jq</span></code>.</p>
<p>Additional user-oriented output is sent to <code class="docutils literal notranslate"><span class="pre">stderr</span></code> via the Logger facility
(see <a class="reference internal" href="#logging"><span class="std std-ref">Logging</span></a>).</p>
</section>
</section>
<section id="integrated-geant4-application-celer-g4">
<span id="celer-g4"></span><h2>Integrated Geant4 application (celer-g4)<a class="headerlink" href="#integrated-geant4-application-celer-g4" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">celer-g4</span></code> app is a Geant4 application that offloads EM tracks to
Celeritas. It takes as input a GDML file with the detector description and
sensitive detectors marked via an <code class="docutils literal notranslate"><span class="pre">auxiliary</span></code> annotation. The input particles
must be specified with a HepMC3-compatible file.</p>
<p>Usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>celer-g4 {commands}.mac
</pre></div>
</div>
<section id="id2">
<h3>Input<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>The input is a Geant4 macro file for executing the program. Celeritas defines
several macros in the <code class="docutils literal notranslate"><span class="pre">/celer</span></code> and (if CUDA is available) <code class="docutils literal notranslate"><span class="pre">/celer/cuda/</span></code>
directories: see <a class="reference internal" href="api/accel.html#api-accel-high-level"><span class="std std-ref">High-level interface</span></a> for a listing.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">celer-g4</span></code> app defines several additional configuration commands under
<code class="docutils literal notranslate"><span class="pre">/celerg4</span></code>:</p>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">Geant4 UI commands defined by <code class="docutils literal notranslate"><span class="pre">celer-g4</span></code>.</span><a class="headerlink" href="#id6" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>geometryFile</p></td>
<td><p>Filename of the GDML detector geometry</p></td>
</tr>
<tr class="row-odd"><td><p>eventFile</p></td>
<td><p>Filename of the event input read by HepMC3</p></td>
</tr>
<tr class="row-even"><td><p>rootBufferSize</p></td>
<td><p>Buffer size of output root file [bytes]</p></td>
</tr>
<tr class="row-odd"><td><p>writeSDHits</p></td>
<td><p>Write a ROOT output file with hits from the SDs</p></td>
</tr>
<tr class="row-even"><td><p>magFieldZ</p></td>
<td><p>Set Z-axis magnetic field strength (T)</p></td>
</tr>
</tbody>
</table>
<p>In addition to these input parameters, <a class="reference internal" href="#environment"><span class="std std-ref">Environment variables</span></a> can be specified to
change the program behavior.</p>
</section>
<section id="id3">
<h3>Output<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>The ROOT “MC truth” output file, if enabled with the command above, contains
hits from all the sensitive detectors.</p>
</section>
</section>
<section id="additional-utilities">
<h2>Additional utilities<a class="headerlink" href="#additional-utilities" title="Permalink to this heading"></a></h2>
<p>The Celeritas installation includes additional utilities for inspecting input
and output.</p>
<section id="celer-export-geant">
<span id="id4"></span><h3>celer-export-geant<a class="headerlink" href="#celer-export-geant" title="Permalink to this heading"></a></h3>
<p>This utility exports the physics and geometry data needed to run Celeritas
without directly calling Geant4 for an independent run. Since it isolates
Celeritas from any existing Geant4 installation it can also be a means of
debugging whether a behavior change is due to a code change in Celeritas or
(for example) a change in cross sections from Geant4.</p>
<hr class="docutils" />
<p>Usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>celer-export-geant {input}.gdml [{options}.json, -, &#39;&#39;] {output}.root
celer-export-geant --dump-default
</pre></div>
</div>
<dl class="simple">
<dt>input</dt><dd><p>Detector definition file</p>
</dd>
<dt>options</dt><dd><p>An optional argument for specifying a JSON file with Geant4 setup options
corresponding to the <a class="reference internal" href="api/celeritas.html#api-geant4-physics-options"><span class="std std-ref">Geant4 physics options</span></a> struct.</p>
</dd>
<dt>output</dt><dd><p>A ROOT output file with the exported <a class="reference internal" href="api/celeritas.html#api-importdata"><span class="std std-ref">Physics data</span></a>.</p>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">--dump-default</span></code> usage renders the default options.</p>
</section>
<section id="celer-dump-data">
<h3>celer-dump-data<a class="headerlink" href="#celer-dump-data" title="Permalink to this heading"></a></h3>
<p>This utility prints an RST-formatted high-level dump of physics data exported
via <a class="reference internal" href="#celer-export-geant"><span class="std std-ref">celer-export-geant</span></a>.</p>
<hr class="docutils" />
<p>Usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>celer-dump-data {output}.root
</pre></div>
</div>
<dl class="simple">
<dt>output</dt><dd><p>A ROOT file containing exported <a class="reference internal" href="api/celeritas.html#api-importdata"><span class="std std-ref">Physics data</span></a>.</p>
</dd>
</dl>
</section>
</section>
<section id="environment-variables">
<span id="environment"></span><h2>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this heading"></a></h2>
<p>Some pieces of core Celeritas code interrogate the environment for variables to
change system- or output-level behavior. These variables are checked once per
execution, and checking them inserts the key and user-defined value (or empty)
into a diagnostic database saved to Celeritas’ JSON output, so the user can
tell what variables are in use or may be useful.</p>
<table class="docutils align-default" id="id7">
<caption><span class="caption-text">Environment variables used by Celeritas.</span><a class="headerlink" href="#id7" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Component</p></th>
<th class="head"><p>Brief description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CELER_BLOCK_SIZE</p></td>
<td><p>corecel</p></td>
<td><p>Change the default block size for kernels</p></td>
</tr>
<tr class="row-odd"><td><p>CELER_COLOR</p></td>
<td><p>corecel</p></td>
<td><p>Enable/disable ANSI color logging</p></td>
</tr>
<tr class="row-even"><td><p>CELER_DEBUG_DEVICE</p></td>
<td><p>corecel</p></td>
<td><p>Increase device error checking and output</p></td>
</tr>
<tr class="row-odd"><td><p>CELER_DISABLE_DEVICE</p></td>
<td><p>corecel</p></td>
<td><p>Disable CUDA/HIP support</p></td>
</tr>
<tr class="row-even"><td><p>CELER_DISABLE_PARALLEL</p></td>
<td><p>corecel</p></td>
<td><p>Disable MPI support</p></td>
</tr>
<tr class="row-odd"><td><p>CELER_LOG</p></td>
<td><p>corecel</p></td>
<td><p>Set the “global” logger verbosity</p></td>
</tr>
<tr class="row-even"><td><p>CELER_LOG_LOCAL</p></td>
<td><p>corecel</p></td>
<td><p>Set the “local” logger verbosity</p></td>
</tr>
<tr class="row-odd"><td><p>CELER_PROFILE_DEVICE</p></td>
<td><p>corecel</p></td>
<td><p>Record extra kernel launch information</p></td>
</tr>
<tr class="row-even"><td><p>CUDA_STACK_SIZE</p></td>
<td><p>celeritas</p></td>
<td><p>Change <code class="docutils literal notranslate"><span class="pre">cudaLimitStackSize</span></code> for VecGeom</p></td>
</tr>
<tr class="row-odd"><td><p>CUDA_HEAP_SIZE</p></td>
<td><p>celeritas</p></td>
<td><p>Change <code class="docutils literal notranslate"><span class="pre">cudaLimitMallocHeapSize</span></code> (VG)</p></td>
</tr>
<tr class="row-even"><td><p>G4VG_COMPARE_VOLUMES</p></td>
<td><p>celeritas</p></td>
<td><p>Check G4VG volume capacity when converting</p></td>
</tr>
<tr class="row-odd"><td><p>CELER_DISABLE</p></td>
<td><p>accel</p></td>
<td><p>Disable Celeritas offloading entirely</p></td>
</tr>
<tr class="row-even"><td><p>CELER_STRIP_SOURCEDIR</p></td>
<td><p>accel</p></td>
<td><p>Strip directories from exception output</p></td>
</tr>
</tbody>
</table>
<p>Environment variables from external libraries can also be referenced by
Celeritas or its apps:</p>
<table class="docutils align-default" id="id8">
<caption><span class="caption-text">Environment variables used by relevant external libraries.</span><a class="headerlink" href="#id8" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Library</p></th>
<th class="head"><p>Brief description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CUDA_VISIBLE_DEVICES</p></td>
<td><p>CUDA</p></td>
<td><p>Set the active CUDA device</p></td>
</tr>
<tr class="row-odd"><td><p>G4LEDATA</p></td>
<td><p>Geant4</p></td>
<td><p>Path to low-energy EM data</p></td>
</tr>
<tr class="row-even"><td><p>G4FORCE_RUN_MANAGER_TYPE</p></td>
<td><p>Geant4</p></td>
<td><p>Use MT or Serial thread layout</p></td>
</tr>
<tr class="row-odd"><td><p>G4FORCENUMBEROFTHREADS</p></td>
<td><p>Geant4</p></td>
<td><p>Set CPU worker thread count</p></td>
</tr>
<tr class="row-even"><td><p>OMP_NUM_THREADS</p></td>
<td><p>OpenMP</p></td>
<td><p>Number of threads per process</p></td>
</tr>
</tbody>
</table>
</section>
<section id="logging">
<span id="id5"></span><h2>Logging<a class="headerlink" href="#logging" title="Permalink to this heading"></a></h2>
<p>The Celeritas library writes informational messages to <code class="docutils literal notranslate"><span class="pre">stderr</span></code>. The given
levels can be used with the <code class="docutils literal notranslate"><span class="pre">CELER_LOG</span></code> and <code class="docutils literal notranslate"><span class="pre">CELER_LOG_LOCAL</span></code> environment
variables to suppress or increase the output. The default is to print
diagnostic messages and higher.</p>
<table class="docutils align-default" id="id9">
<caption><span class="caption-text">Logging levels in increasing severity.</span><a class="headerlink" href="#id9" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Level</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>debug</p></td>
<td><p>Low-level debugging messages</p></td>
</tr>
<tr class="row-odd"><td><p>diagnostic</p></td>
<td><p>Diagnostics about current program execution</p></td>
</tr>
<tr class="row-even"><td><p>status</p></td>
<td><p>Program execution status (what stage is beginning)</p></td>
</tr>
<tr class="row-odd"><td><p>info</p></td>
<td><p>Important informational messages</p></td>
</tr>
<tr class="row-even"><td><p>warning</p></td>
<td><p>Warnings about unusual events</p></td>
</tr>
<tr class="row-odd"><td><p>error</p></td>
<td><p>Something went wrong, but execution can continue</p></td>
</tr>
<tr class="row-even"><td><p>critical</p></td>
<td><p>Something went terribly wrong, program termination imminent</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="Library API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, UT–Battelle/ORNL and Celeritas team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
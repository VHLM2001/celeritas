<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Celeritas: TrackInitUtils.hh File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../celeritas-square.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Celeritas<span id="projectnumber">&#160;v0.3.0-dev.62+f351e714</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_54b4dc0a5a8b71d7ed2a0028b382827b.html">celeritas</a></li><li class="navelem"><a class="el" href="../../dir_7c7a6cdf0b613f36bb11e9e4267074b8.html">track</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">TrackInitUtils.hh File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Helper functions for initializing tracks.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;type_traits&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d9/dfc/_collection_builder_8hh.html">corecel/data/CollectionBuilder.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d7/d40/_copier_8hh.html">corecel/data/Copier.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/df9/_ref_8hh.html">corecel/data/Ref.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d1/dee/_algorithms_8hh.html">corecel/math/Algorithms.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d7/de3/_core_track_data_8hh.html">celeritas/global/CoreTrackData.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/d7e/_track_init_data_8hh.html">TrackInitData.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d92/_track_init_algorithms_8hh.html">detail/TrackInitAlgorithms.hh</a>&quot;</code><br />
<code>#include &quot;generated/InitTracks.hh&quot;</code><br />
<code>#include &quot;generated/LocateAlive.hh&quot;</code><br />
<code>#include &quot;generated/ProcessPrimaries.hh&quot;</code><br />
<code>#include &quot;generated/ProcessSecondaries.hh&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88bed6cff5cab8b6712c2e625a945e3e"><td class="memTemplParams" colspan="2"><a id="a88bed6cff5cab8b6712c2e625a945e3e" name="a88bed6cff5cab8b6712c2e625a945e3e"></a>
template&lt;MemSpace M&gt; </td></tr>
<tr class="memitem:a88bed6cff5cab8b6712c2e625a945e3e"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><b>celeritas::extend_from_primaries</b> (CoreRef&lt; M &gt; const &amp;core_data, Span&lt; Primary const &gt; host_primaries)</td></tr>
<tr class="memdesc:a88bed6cff5cab8b6712c2e625a945e3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create track initializers from a vector of host primary particles. <br /></td></tr>
<tr class="separator:a88bed6cff5cab8b6712c2e625a945e3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab59282ae577277e1779efd0d2299227d"><td class="memTemplParams" colspan="2">template&lt;MemSpace M&gt; </td></tr>
<tr class="memitem:ab59282ae577277e1779efd0d2299227d"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d6/de6/_track_init_utils_8hh.html#ab59282ae577277e1779efd0d2299227d">celeritas::initialize_tracks</a> (CoreRef&lt; M &gt; const &amp;core_data)</td></tr>
<tr class="memdesc:ab59282ae577277e1779efd0d2299227d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize track states.  <a href="../../d6/de6/_track_init_utils_8hh.html#ab59282ae577277e1779efd0d2299227d">More...</a><br /></td></tr>
<tr class="separator:ab59282ae577277e1779efd0d2299227d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacef787e4d3a3165534c92fb61e471fb"><td class="memTemplParams" colspan="2">template&lt;MemSpace M&gt; </td></tr>
<tr class="memitem:aacef787e4d3a3165534c92fb61e471fb"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d6/de6/_track_init_utils_8hh.html#aacef787e4d3a3165534c92fb61e471fb">celeritas::extend_from_secondaries</a> (CoreRef&lt; M &gt; const &amp;core_data)</td></tr>
<tr class="memdesc:aacef787e4d3a3165534c92fb61e471fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create track initializers on device from secondary particles.  <a href="../../d6/de6/_track_init_utils_8hh.html#aacef787e4d3a3165534c92fb61e471fb">More...</a><br /></td></tr>
<tr class="separator:aacef787e4d3a3165534c92fb61e471fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Helper functions for initializing tracks. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aacef787e4d3a3165534c92fb61e471fb" name="aacef787e4d3a3165534c92fb61e471fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacef787e4d3a3165534c92fb61e471fb">&#9670;&#160;</a></span>extend_from_secondaries()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;MemSpace M&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void celeritas::extend_from_secondaries </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/da8/structceleritas_1_1_core_ref.html">CoreRef</a>&lt; M &gt; const &amp;&#160;</td>
          <td class="paramname"><em>core_data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create track initializers on device from secondary particles. </p>
<p >Secondaries produced by each track are ordered arbitrarily in memory, and the memory may be fragmented if not all secondaries survived cutoffs. For example, after the interactions have been processed and cutoffs applied, the track states and their secondaries might look like the following (where 'X' indicates a track or secondary that did not survive): </p><pre class="fragment"> thread ID   | 0   1 2           3       4   5 6           7       8   9
 track ID    | 10  X 8           7       X   5 4           X       2   1
 secondaries | [X]   [X, 11, 12] [13, X] [X]   [14, X, 15] [X, 16] [X]</pre><p >Because the order in which threads receive a chunk of memory from the secondary allocator is nondeterministic, the actual ordering of the secondaries in memory is unpredictable; for instance: </p><pre class="fragment">secondary storage | [X, 13, X, X, 11, 12, X, X, 16, 14, X, 15, X]</pre><p >When track initializers are created from secondaries, they are ordered by thread ID to ensure reproducibility. If a track that produced secondaries has died (e.g., thread ID 7 in the example above), one of its secondaries is immediately used to fill that track slot: </p><pre class="fragment"> thread ID   | 0   1 2           3       4   5 6           7       8   9
 track ID    | 10  X 8           7       X   5 4           16      2   1
 secondaries | [X]   [X, 11, 12] [13, X] [X]   [14, X, 15] [X, X]  [X]</pre><p >This way, the geometry state is reused rather than initialized from the position (which is expensive). This also prevents the geometry state from being overwritten by another track's secondary, so if the track produced multiple secondaries, the rest are still able to copy the parent's state.</p>
<p >Track initializers are created from the remaining secondaries and are added to the back of the vector. The thread ID of each secondary's parent is also stored, so any new tracks initialized from secondaries produced in this step can copy the geometry state from the parent. The indices of the empty slots in the track vector are identified and stored as a sorted vector of vacancies. </p><pre class="fragment"> track initializers | 11 12 13 14 15
 parent             | 2  2  3  6  6
 vacancies          | 1  4</pre> 
</div>
</div>
<a id="ab59282ae577277e1779efd0d2299227d" name="ab59282ae577277e1779efd0d2299227d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab59282ae577277e1779efd0d2299227d">&#9670;&#160;</a></span>initialize_tracks()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;MemSpace M&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void celeritas::initialize_tracks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/da8/structceleritas_1_1_core_ref.html">CoreRef</a>&lt; M &gt; const &amp;&#160;</td>
          <td class="paramname"><em>core_data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize track states. </p>
<p >Tracks created from secondaries produced in this step will have the geometry state copied over from the parent instead of initialized from the position. If there are more empty slots than new secondaries, they will be filled by any track initializers remaining from previous steps using the position. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>

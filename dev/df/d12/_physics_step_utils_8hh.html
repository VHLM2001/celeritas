<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Celeritas: PhysicsStepUtils.hh File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../celeritas-square.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Celeritas<span id="projectnumber">&#160;0.3.0-rc.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_54b4dc0a5a8b71d7ed2a0028b382827b.html">celeritas</a></li><li class="navelem"><a class="el" href="../../dir_a2f2878bfcf7388da69bc3443a902be8.html">phys</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">PhysicsStepUtils.hh File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Helper functions for physics step processing.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../d5/d10/_assert_8hh.html">corecel/Assert.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/df5/corecel_2_types_8hh.html">corecel/Types.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/de4/_range_8hh.html">corecel/cont/Range.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d1/dee/_algorithms_8hh.html">corecel/math/Algorithms.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/d78/_numeric_limits_8hh.html">corecel/math/NumericLimits.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/da7/celeritas_2_types_8hh.html">celeritas/Types.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../da/dba/_energy_loss_calculator_8hh.html">celeritas/grid/EnergyLossCalculator.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dc/dd2/_inverse_range_calculator_8hh.html">celeritas/grid/InverseRangeCalculator.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d78/_range_calculator_8hh.html">celeritas/grid/RangeCalculator.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../da/d6b/_value_grid_data_8hh.html">celeritas/grid/ValueGridData.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d1/d9e/_xs_calculator_8hh.html">celeritas/grid/XsCalculator.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d20/_material_track_view_8hh.html">celeritas/mat/MaterialTrackView.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/da9/_selector_8hh.html">celeritas/random/Selector.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/dca/_bernoulli_distribution_8hh.html">celeritas/random/distribution/BernoulliDistribution.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/d5a/_generate_canonical_8hh.html">celeritas/random/distribution/GenerateCanonical.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/d1d/_particle_track_view_8hh.html">ParticleTrackView.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/d04/_physics_step_view_8hh.html">PhysicsStepView.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/dcc/_physics_track_view_8hh.html">PhysicsTrackView.hh</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af08c6d69e51e1d7f7a4a0a96a272d5b0"><td class="memItemLeft" align="right" valign="top"><a id="af08c6d69e51e1d7f7a4a0a96a272d5b0" name="af08c6d69e51e1d7f7a4a0a96a272d5b0"></a>
<a class="el" href="../../db/dc5/_macros_8hh.html#ac631c1bc86fa5c49ade05cca94ae1794">CELER_FUNCTION</a> StepLimit&#160;</td><td class="memItemRight" valign="bottom"><b>celeritas::calc_physics_step_limit</b> (MaterialTrackView const &amp;material, ParticleTrackView const &amp;particle, PhysicsTrackView &amp;physics, PhysicsStepView &amp;pstep)</td></tr>
<tr class="memdesc:af08c6d69e51e1d7f7a4a0a96a272d5b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate physics step limits based on cross sections and range limiters. <br /></td></tr>
<tr class="separator:af08c6d69e51e1d7f7a4a0a96a272d5b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a055ca1339377867bd45f753893660598"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/dc5/_macros_8hh.html#ac631c1bc86fa5c49ade05cca94ae1794">CELER_FUNCTION</a> ParticleTrackView::Energy&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d12/_physics_step_utils_8hh.html#a055ca1339377867bd45f753893660598">celeritas::calc_mean_energy_loss</a> (ParticleTrackView const &amp;particle, PhysicsTrackView const &amp;physics, real_type step)</td></tr>
<tr class="memdesc:a055ca1339377867bd45f753893660598"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate mean energy loss over the given "true" step length.  <a href="../../df/d12/_physics_step_utils_8hh.html#a055ca1339377867bd45f753893660598">More...</a><br /></td></tr>
<tr class="separator:a055ca1339377867bd45f753893660598"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c19e4a4cd9d7276ad902730ec8949a0"><td class="memTemplParams" colspan="2">template&lt;class Engine &gt; </td></tr>
<tr class="memitem:a0c19e4a4cd9d7276ad902730ec8949a0"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../db/dc5/_macros_8hh.html#ac631c1bc86fa5c49ade05cca94ae1794">CELER_FUNCTION</a> ActionId&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../df/d12/_physics_step_utils_8hh.html#a0c19e4a4cd9d7276ad902730ec8949a0">celeritas::select_discrete_interaction</a> (MaterialView const &amp;material, ParticleTrackView const &amp;particle, PhysicsTrackView const &amp;physics, PhysicsStepView &amp;pstep, Engine &amp;rng)</td></tr>
<tr class="memdesc:a0c19e4a4cd9d7276ad902730ec8949a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Choose the physics model for a track's pending interaction.  <a href="../../df/d12/_physics_step_utils_8hh.html#a0c19e4a4cd9d7276ad902730ec8949a0">More...</a><br /></td></tr>
<tr class="separator:a0c19e4a4cd9d7276ad902730ec8949a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Helper functions for physics step processing. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a055ca1339377867bd45f753893660598" name="a055ca1339377867bd45f753893660598"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a055ca1339377867bd45f753893660598">&#9670;&#160;</a></span>calc_mean_energy_loss()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/dc5/_macros_8hh.html#ac631c1bc86fa5c49ade05cca94ae1794">CELER_FUNCTION</a> ParticleTrackView::Energy celeritas::calc_mean_energy_loss </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dd5/classceleritas_1_1_particle_track_view.html">ParticleTrackView</a> const &amp;&#160;</td>
          <td class="paramname"><em>particle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/dd9/classceleritas_1_1_physics_track_view.html">PhysicsTrackView</a> const &amp;&#160;</td>
          <td class="paramname"><em>physics</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/df5/corecel_2_types_8hh.html#ac97c7d9259eb113cfcc54c671fd2173d">real_type</a>&#160;</td>
          <td class="paramname"><em>step</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate mean energy loss over the given "true" step length. </p>
<p >See section 7.2.4 Run Time Energy Loss Computation of the Geant4 physics manual. See also the longer discussions in section 8 of PHYS010 of the Geant3 manual (1993). Stopping power is an integral over low-exiting-energy secondaries. Above some threshold energy <em>T_c</em> we treat exiting secondaries discretely; below it, we lump them into this continuous loss term that varies based on the energy, the atomic number density, and the element number:  </p><p class="formulaDsp">
<picture><source srcset="../../form_151_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
  \frac{dE}{dx} = N_Z \int_0^{T_c} \frac{d \sigma_Z(E, T)}{dT} T dT
\]" src="../../form_151.png" width="165" height="33"/></picture>
</p>
<p> Here, the cross section is a function of the primary's energy <em>E</em> and the exiting secondary energy <em>T</em>.</p>
<p >The stopping range <em>R</em> due to these low-energy processes is an integral over the inverse of the stopping power: basically the distance that will take a particle (without discrete processes at play) from its current energy to an energy of zero.  </p><p class="formulaDsp">
<picture><source srcset="../../form_152_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
  R = \int_0 ^{E_0} - \frac{dx}{dE} dE .
\]" src="../../form_152.png" width="101" height="33"/></picture>
</p>
<p >Both Celeritas and Geant4 approximate the range limit as the minimum range over all processes, rather than the range as a result from integrating all energy loss processes over the allowed energy range. This is usually not a problem in practice because the range will get automatically decreased by <code>range_to_step</code> , and the above range calculation neglects energy loss by discrete processes.</p>
<p >Both Geant4 and Celeritas integrate the energy loss terms across processes to get a single energy loss vector per particle type. The range table is an integral of the mean stopping power: the total distance for the particle's energy to reach zero.</p>
<dl class="section note"><dt>Note</dt><dd>The inverse range correction assumes range is always the integral of the stopping power/energy loss.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000012">Todo:</a></b></dt><dd>The geant3 manual makes the point that linear interpolation of energy loss rate results in a piecewise constant energy deposition curve, which is why they use spline interpolation. Investigate higher-order reconstruction of energy loss curve, e.g. through spline-based interpolation or log-log interpolation.</dd></dl>
<p >Zero energy loss can occur in the following cases:</p><ul>
<li>The energy loss value at the given energy is zero (e.g. high energy particles)</li>
<li>The urban model is selected and samples zero collisions (possible in thin materials and/or small steps) </li>
</ul>

</div>
</div>
<a id="a0c19e4a4cd9d7276ad902730ec8949a0" name="a0c19e4a4cd9d7276ad902730ec8949a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c19e4a4cd9d7276ad902730ec8949a0">&#9670;&#160;</a></span>select_discrete_interaction()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class Engine &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/dc5/_macros_8hh.html#ac631c1bc86fa5c49ade05cca94ae1794">CELER_FUNCTION</a> ActionId celeritas::select_discrete_interaction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/de4/classceleritas_1_1_material_view.html">MaterialView</a> const &amp;&#160;</td>
          <td class="paramname"><em>material</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/dd5/classceleritas_1_1_particle_track_view.html">ParticleTrackView</a> const &amp;&#160;</td>
          <td class="paramname"><em>particle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/dd9/classceleritas_1_1_physics_track_view.html">PhysicsTrackView</a> const &amp;&#160;</td>
          <td class="paramname"><em>physics</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/dcd/classceleritas_1_1_physics_step_view.html">PhysicsStepView</a> &amp;&#160;</td>
          <td class="paramname"><em>pstep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Engine &amp;&#160;</td>
          <td class="paramname"><em>rng</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Choose the physics model for a track's pending interaction. </p>
<ul>
<li>If the interaction MFP is zero, the particle is undergoing a discrete interaction. Otherwise, the result is a false ActionId.</li>
<li>Sample from the previously calculated per-process cross section/decay to determine the interacting process ID.</li>
<li>From the process ID and (post-slowing-down) particle energy, we obtain the applicable model ID.</li>
<li>For energy loss (continuous-discrete) processes, the post-step energy will be different from the pre-step energy, so the assumption that the cross section is constant along the step is no longer valid. Use the "integral
  approach" to sample the discrete interaction from the correct probability distribution (section 7.4 of the Geant4 Physics Reference release 10.6). </li>
</ul>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>

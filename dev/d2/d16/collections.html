<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Celeritas: Collection: a data portability class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
   TeX: { Macros: {
    dif: "{\\;\\mathrm{d}}",
  } }
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../celeritas-square.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Celeritas<span id="projectnumber">&#160;0.4.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Collection: a data portability class</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code><a class="el" href="../../d7/dd4/classceleritas_1_1_collection.html" title="Manage generic array-like data ownership and transfer from host to device.">Collection</a></code> manages data allocation and transfer between CPU and GPU. Its primary design goal is facilitating construction of deeply hierarchical data on host at setup time and seamlessly copying to device. The templated <code>T</code> must be trivially copyable&mdash;either a fundamental data type or a struct of such types.</p>
<p>An individual item in a <code>Collection&lt;T&gt;</code> can be accessed with <code>ItemId&lt;T&gt;</code>, a contiguous subset of items are accessed with <code>ItemRange&lt;T&gt;</code>, and the entirety of the data are accessed with <code>AllItems&lt;T&gt;</code>. All three of these classes are trivially copyable, so they can be embedded in structs that can be managed by a <a class="el" href="../../d7/dd4/classceleritas_1_1_collection.html" title="Manage generic array-like data ownership and transfer from host to device.">Collection</a>. A group of Collections, one for each data type, can therefore be trivially copied to the GPU to enable arbitrarily deep and complex data hierarchies.</p>
<p>By convention, groups of Collections comprising the data for a single class or subsystem (such as <a class="el" href="../../d2/d1c/classceleritas_1_1_rayleigh_interactor.html" title="Apply the Livermore model of Rayleigh scattering to photons.">RayleighInteractor</a> or Physics) are stored in a helper struct suffixed with <code>Data</code> . For cases where there is both persistent data (problem-specific parameters) and transient data (track-specific states), the collections must be grouped into two separate classes. <code>StateData</code> are meant to be mutable and never directly copied between host and device; its data collections are typically accessed by thread ID. <code>ParamsData</code> are immutable and always "mirrored" on both host and device. Sometimes it's sensible to partition <code>ParamsData</code> into discrete helper structs (stored by value), each with a group of collections, and perhaps another struct that has non-templated scalars (since the default assignment operator is less work than manually copying scalars in a templated assignment operator.</p>
<p>A collection group has the following requirements to be compatible with the <code><a class="el" href="../../d9/d90/classceleritas_1_1_collection_mirror.html" title="Helper class for copying setup-time Collection groups to host and device.">CollectionMirror</a></code>, <code><a class="el" href="../../dc/d8c/classceleritas_1_1_collection_state_store.html" title="Helper class for storing Collection classes on host or device.">CollectionStateStore</a></code>, and other such helper classes:</p><ul>
<li>Be a struct templated with <code>template&lt;Ownership W, MemSpace M&gt;</code> </li>
<li>Contain only <a class="el" href="../../d7/dd4/classceleritas_1_1_collection.html" title="Manage generic array-like data ownership and transfer from host to device.">Collection</a> objects and trivially copyable structs</li>
<li>Define an operator bool that is true if and only if the class data is assigned and consistent</li>
<li>Define a templated assignment operator on "other" Ownership and MemSpace which assigns every member to the right-hand-side's member</li>
</ul>
<p>Additionally, a <code>StateData</code> collection group must define</p><ul>
<li>A member function <code>size()</code> returning the number of entries (i.e. number of threads)</li>
<li>A free function <code>resize</code> with one of two signatures: <div class="fragment"><div class="line"><span class="keywordtype">void</span> resize(</div>
<div class="line">    StateData&lt;Ownership::value, M&gt;* data,</div>
<div class="line">    <span class="keyword">const</span> HostCRef&lt;ParamsData&gt;&amp;     params,</div>
<div class="line">    size_type                       size);</div>
<div class="line"><span class="comment">// or...</span></div>
<div class="line"><span class="keywordtype">void</span> resize(</div>
<div class="line">    StateData&lt;Ownership::value, M&gt;* data,</div>
<div class="line">    size_type                       size);</div>
</div><!-- fragment --></li>
</ul>
<p>By convention, related groups of collections are stored in a header file named <code>Data.hh</code> .</p>
<p>See <a class="el" href="../../d9/d5a/structceleritas_1_1_particle_params_data.html" title="Access particle definitions on the device.">ParticleParamsData</a> and <a class="el" href="../../d7/db9/structceleritas_1_1_particle_state_data.html" title="Data storage/access for particle properties.">ParticleStateData</a> for minimal examples of using collections. The <a class="el" href="../../de/d29/structceleritas_1_1_material_params_data.html" title="Access material properties on the device.">MaterialParamsData</a> demonstrates additional complexity by having a multi-level data hierarchy, and <a class="el" href="../../d6/d79/structceleritas_1_1_material_state_data.html" title="Store dynamic states of multiple physical particles.">MaterialStateData</a> has a resize function that uses params data. <a class="el" href="../../db/dfa/structceleritas_1_1_physics_params_data.html" title="Persistent shared physics data.">PhysicsParamsData</a> is a very complex example, and GeoParamsData demonstates how to use template specialization to adapt Collections to another codebase with a different convention for host-device portability. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
